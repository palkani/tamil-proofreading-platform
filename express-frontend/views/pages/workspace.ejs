<%- include('../partials/header') %>

<div class="min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-white border-b border-gray-200 px-6 py-3">
    <div class="flex items-center justify-between">
      <!-- Left: Back to Drafts -->
      <div>
        <button id="show-drafts-btn" class="text-gray-600 hover:text-gray-900 flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          <span class="font-medium">My Drafts</span>
        </button>
      </div>

      <!-- Center: Editable Title -->
      <div class="flex-1 max-w-md mx-8">
        <input 
          type="text" 
          id="draft-title"
          class="w-full text-lg font-semibold text-center border-0 border-b-2 border-transparent hover:border-gray-300 focus:border-orange-500 focus:ring-0 outline-none px-4 py-1 transition-colors"
          value="Untitled Draft"
          placeholder="Draft title..."
        />
      </div>

      <!-- Right: Save Status & Actions -->
      <div class="flex items-center gap-4">
        <span id="save-status" class="text-sm text-gray-500">
          <span class="inline-block w-2 h-2 bg-green-500 rounded-full mr-2"></span>
          Saved
        </span>
        <button id="logout-btn" class="text-gray-600 hover:text-gray-900">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="flex-1" style="display: grid; grid-template-columns: 1fr 384px; overflow: hidden;">
    <!-- Drafts List View (Hidden by default) -->
    <div id="drafts-list-view" class="hidden bg-slate-50 overflow-auto" style="grid-column: 1 / -1;">
      <div class="max-w-4xl mx-auto px-6 py-8">
        <div class="mb-6">
          <h2 class="text-2xl font-bold text-gray-900 mb-2">My Drafts</h2>
          <p class="text-sm text-gray-600">All your Tamil text submissions and drafts</p>
        </div>

        <div class="flex justify-between items-center mb-4">
          <button id="new-draft-btn" class="btn-primary">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            New Draft
          </button>
          <div id="drafts-loading" class="hidden text-sm text-gray-500">Loading drafts...</div>
        </div>

        <div id="drafts-container" class="space-y-3">
          <!-- Drafts will be loaded here -->
        </div>

        <div id="no-drafts-message" class="hidden text-center py-12">
          <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          <p class="text-gray-500 text-lg mb-2">No drafts yet</p>
          <p class="text-gray-400 text-sm mb-4">Create your first Tamil text draft to get started</p>
          <button id="create-first-draft-btn" class="btn-primary">Create First Draft</button>
        </div>
      </div>
    </div>

    <!-- Left: Editor Panel -->
    <div class="flex flex-col bg-slate-50 border-r border-gray-200" style="overflow: hidden;">
      <!-- Enhanced Toolbar -->
      <div class="bg-white border-b border-gray-200 px-4 py-2 shadow-sm overflow-x-auto">
        <div class="flex items-center gap-1 min-w-max">
          <!-- Undo/Redo -->
          <button class="toolbar-btn" data-command="undo" title="Undo">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/>
            </svg>
          </button>
          <button class="toolbar-btn" data-command="redo" title="Redo">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"/>
            </svg>
          </button>
          
          <div class="w-px h-6 bg-gray-300 mx-2"></div>
          
          <!-- Font Size -->
          <select class="toolbar-select" id="font-size-select" title="Font size">
            <option value="12px">12</option>
            <option value="14px">14</option>
            <option value="16px" selected>16</option>
            <option value="18px">18</option>
            <option value="20px">20</option>
            <option value="24px">24</option>
            <option value="28px">28</option>
            <option value="32px">32</option>
          </select>
          
          <div class="w-px h-6 bg-gray-300 mx-2"></div>
          
          <!-- Lists -->
          <button class="toolbar-btn" data-command="insertUnorderedList" title="Bullet list">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/>
            </svg>
          </button>
          <button class="toolbar-btn" data-command="insertOrderedList" title="Numbered list">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"/>
            </svg>
          </button>
          
          <div class="w-px h-6 bg-gray-300 mx-2"></div>
          
          <!-- Alignment Dropdown -->
          <div class="relative inline-block">
            <button class="toolbar-btn" id="align-dropdown-btn" title="Alignment">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M3 21h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18V7H3v2zm0-6v2h18V3H3z"/>
              </svg>
              <svg class="w-3 h-3 ml-1" fill="currentColor" viewBox="0 0 20 20">
                <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
              </svg>
            </button>
            <div id="align-dropdown" class="hidden absolute left-0 mt-1 w-40 bg-white rounded-md shadow-lg border border-gray-200 z-10">
              <button class="dropdown-item" data-command="justifyLeft">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M3 21h18v-2H3v2zm0-4h12v-2H3v2zm0-4h18v-2H3v2zm0-4h12V7H3v2zm0-6v2h18V3H3z"/>
                </svg>
                Align Left
              </button>
              <button class="dropdown-item" data-command="justifyCenter">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M7 15v2h10v-2H7zm-4 6h18v-2H3v2zm0-8h18v-2H3v2zm4-6v2h10V7H7zM3 3v2h18V3H3z"/>
                </svg>
                Align Center
              </button>
              <button class="dropdown-item" data-command="justifyRight">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M3 21h18v-2H3v2zm6-4h12v-2H9v2zm-6-4h18v-2H3v2zm6-4h12V7H9v2zM3 3v2h18V3H3z"/>
                </svg>
                Align Right
              </button>
              <button class="dropdown-item" data-command="justifyFull">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M3 21h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18V7H3v2zm0-6v2h18V3H3z"/>
                </svg>
                Justify
              </button>
            </div>
          </div>
          
          <div class="w-px h-6 bg-gray-300 mx-2"></div>
          
          <!-- Link -->
          <button class="toolbar-btn" id="insert-link-btn" title="Insert link">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
            </svg>
          </button>
          
          <!-- Search (Placeholder) -->
          <button class="toolbar-btn" id="search-btn" title="Search">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </svg>
          </button>
          
          <div class="w-px h-6 bg-gray-300 mx-2"></div>
          
          <!-- Translate English to Tamil -->
          <button class="toolbar-btn bg-orange-100 hover:bg-orange-200 text-orange-700" id="translate-english-btn" title="Translate English to Tamil">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/>
            </svg>
            <span class="ml-1 text-xs font-medium">Translate</span>
          </button>
          
          <div class="flex-1"></div>
        </div>
      </div>

      <!-- Editor -->
      <div class="flex-1 overflow-auto px-6 py-4 pb-6">
        <div 
          id="editor" 
          class="editor-content bg-white rounded-xl shadow-sm border border-gray-200 min-h-[500px] p-6 tamil-text text-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none"
          contenteditable="true"
          spellcheck="false"
          placeholder="தமிழில் எழுதத் தொடங்குங்கள்..."
        ></div>
      </div>
    </div>

    <!-- Right: AI Assistant Panel -->
    <div id="ai-assistant-panel" class="bg-white flex flex-col border-l border-gray-200" style="overflow: hidden;">
      <!-- Panel Header -->
      <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-lg font-semibold text-gray-900">AI Assistant</h3>
          <button id="accept-all-btn" class="text-sm text-orange-600 hover:text-orange-700 font-medium hidden">
            Accept All
          </button>
        </div>
        <p id="suggestions-summary" class="text-sm text-gray-500">
          No suggestions yet
        </p>
        <p id="suggestions-remaining" class="text-xs text-orange-600 font-medium mt-2">
          Loading suggestions limit...
        </p>
      </div>

      <!-- Suggestions List -->
      <div id="suggestions-container" class="flex-1 overflow-auto px-6 py-4 space-y-6">
        <div class="text-center text-gray-400 py-12">
          <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
          </svg>
          <p class="text-sm">Type or paste Tamil text in the editor</p>
          <p class="text-xs mt-2">AI suggestions appear automatically as you type</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer Status Bar -->
  <footer class="bg-slate-50 border-t border-gray-200 px-6 py-3">
    <div class="flex items-center justify-between text-sm text-gray-600">
      <div class="flex items-center gap-6">
        <span id="word-count">Words: 0</span>
        <span id="accepted-count">Accepted: 0</span>
      </div>
      <span id="autosave-time" class="text-xs text-gray-400">
        Last saved: Never
      </span>
    </div>
  </footer>
</div>

<!-- Include Tamil utilities and editor scripts -->
<script src="/js/tamilDictionary.js?v=20251127b"></script>
<script src="/js/transliteration.js?v=20251127b"></script>
<script src="/js/tamilUtils.js?v=20251127b"></script>
<script src="/js/editor.js?v=20251127b"></script>
<script src="/js/suggestions.js?v=20251127b"></script>
<script src="/js/workspace.js?v=20251127b"></script>
<script src="/js/oauth-callback.js"></script>

<%- include('../partials/footer') %>
